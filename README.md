# Wizard of Music bot

Бот предназначен для соединения пар пользователей (покупатель и продавец), которые бы между собой торговались.

Каждый юзер может находиться в нескольких состояниях (`current_role`):
- `active`    - не играет, но готов начинать игру прямо сейчас
- `inactive`  - не играет, и не готов начинать игру прямо сейчас
- `buyer/seller` - играет с соответствующей ролью
- `feedback_(deal/why_not/terms/like)` - завершил игру, и отвечает на вопросы про неё

Виды фидбека:
- `deal` - смогли ли договориться о сделке
- `terms` - на каких условиях договорились (только если смогли)
- `why_not` - почему не удалось договориться (только если не смогли)
- `like` - насколько понравилась игра, по шкале от 1 до 5

Возможные переходы:
 - `inactive --> buyer/seller`: по кнопке "начать игру" (если есть с кем играть, т.е. есть кто-то в состоянии `active`). 
 Выбор между ролями `buyer` и `seller` совершается случайно.
 - `inactive --> active`: по кнопке "начать игру" (если не с кем играть)
 - `active --> buyer/seller`: если другой игрок нажал "начать игру"
 - `active --> inactive`: по кнопке "не начинать игру"
 - `buyer/seller --> feedback`: по кнопке "завершить игру" (в т.ч. если её нажмёт второй игрок)
- `feedback --> inactive`: после того, как ответит на все вопросы про завершившуюся игру

Кроме этого, у каждого состояния есть два бинарный модификатор `allow_notifications`,
он определяет, получает ли юзер, находясь в состоянии inactive, уведомления
о других игроках, переходящих в состояние active. Он переключается отдельной кнопкой 
"получать уведомления" / "не получать уведомления". 

Все сообщения логируются в mongodb. В отдельную табличку логируются все события, непосредственно относящиеся к игре
(сообщения внутри игры, а также начало и конец игры). 

![image of Rincewind the Wizzard](https://cdn.drawception.com/images/panels/2016/4-27/htzf4P12rT-4.png)
